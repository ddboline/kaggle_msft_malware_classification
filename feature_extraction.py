#!/usr/bin/python

import os
import gzip
import csv
from collections import deque, defaultdict

def feature_extraction(prefix):
    ngram_count = defaultdict(int)
    most_recent_bytes = deque(maxlen=2)
    with gzip.open('%s.bytes.gz' % prefix, 'rb') as asmfile:
        for line in asmfile:
            for ent in line.split()[1:]:
                most_recent_bytes.append(ent)
                if len(most_recent_bytes) != 2:
                    continue
                ngram_count[''.join(most_recent_bytes)] += 1
    with gzip.open('%s.ngram.gz' % prefix, 'wb') as ngramfile:
        ngramfile.write('ngram,count\n')
        for w, c in sorted(ngram_count.items(), key=lambda x: x[1]):
            ngramfile.write('%s,%s\n' % (w, c))
    return

if __name__ == '__main__':
    feature_extraction(os.sys.argv[1])
